// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADMIN
  CORRETOR
}

enum ImovelTipo {
  VENDA
  ALUGUEL
}

enum ImovelStatus {
  ATIVO
  INATIVO
  VENDIDO
  ALUGADO
}

enum LeadStatus {
  NOVO
  CONTATADO
  QUALIFICADO
  NEGOCIACAO
  CONVERTIDO
  PERDIDO
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String
  role      UserRole
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relacionamentos
  corretorProfile CorretorProfile?
  admin           Admin?

  @@map("users")
}

model CorretorProfile {
  id          String   @id @default(cuid())
  userId      String   @unique
  slug        String   @unique
  bio         String?  @db.Text
  phone       String?
  photo       String?
  whatsapp    String?
  cidade      String?
  approved    Boolean  @default(false)
  landingAtiva Boolean @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relacionamentos
  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  imoveis       Imovel[]
  leads         Lead[]
  landingBlocos LandingBloco[]

  @@map("corretor_profiles")
}

model Admin {
  id        String   @id @default(cuid())
  userId    String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relacionamentos
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("admins")
}

model Imovel {
  id          String        @id @default(cuid())
  corretorId  String
  titulo      String
  descricao   String        @db.Text
  tipo        ImovelTipo
  status      ImovelStatus  @default(ATIVO)
  valor       Decimal       @db.Decimal(10, 2)
  endereco    String
  cidade      String
  estado      String
  cep         String?
  bairro      String?
  quartos     Int?
  banheiros   Int?
  area        Decimal?      @db.Decimal(10, 2)
  garagem     Int?
  images      String[]      @default([])
  views       Int           @default(0)
  latitude    Decimal?      @db.Decimal(10, 8)
  longitude   Decimal?      @db.Decimal(11, 8)
  destaque    Boolean       @default(false)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  // Relacionamentos
  corretor CorretorProfile @relation(fields: [corretorId], references: [id], onDelete: Cascade)
  leads    Lead[]

  @@index([corretorId])
  @@index([tipo])
  @@index([status])
  @@index([cidade])
  @@index([destaque])
  @@map("imoveis")
}

model Lead {
  id         String     @id @default(cuid())
  imovelId   String?
  corretorId String
  name       String
  email      String?
  phone      String
  message    String?    @db.Text
  origem     String?    @default("site")
  status     LeadStatus @default(NOVO)
  anotacoes  String?    @db.Text
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt

  // Relacionamentos
  imovel   Imovel?         @relation(fields: [imovelId], references: [id], onDelete: Cascade)
  corretor CorretorProfile @relation(fields: [corretorId], references: [id], onDelete: Cascade)

  @@index([corretorId])
  @@index([imovelId])
  @@index([status])
  @@index([createdAt])
  @@map("leads")
}

model LandingBloco {
  id         String   @id @default(cuid())
  corretorId String
  tipo       String   // hero | historia | galeria | carrossel | cta | imoveis | video | contato
  titulo     String?
  subtitulo  String?
  texto      String?  @db.Text
  imagens    String[] @default([])
  videoUrl   String?
  ordem      Int
  ativo      Boolean  @default(true)
  config     Json?    // Configurações adicionais específicas do bloco
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relacionamentos
  corretor CorretorProfile @relation(fields: [corretorId], references: [id], onDelete: Cascade)

  @@index([corretorId])
  @@index([ordem])
  @@map("landing_blocos")
}
